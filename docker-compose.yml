services:
  web:
    container_name: shenleng-container
    image: ghcr.io/sarsimour/shenleng:latest
    restart: unless-stopped
    user: "1000:1000"
    ports:
      - "3000:3000"
    volumes:
      # 使用绝对路径，避免 ~ 解析歧义
      - /home/ecs-user/data/shenleng/persistence/sqlite:/app/database
      - /home/ecs-user/data/shenleng/persistence/media:/app/public/media
      - /home/ecs-user/data/shenleng/migration_source:/app/migration_data:ro
    environment:
      - NODE_ENV=production
      - PAYLOAD_SECRET=${PAYLOAD_SECRET}
      - DATABASE_URI=file:/app/database/payload.db
      - PAYLOAD_CONFIG_PATH=src/payload.config.ts
      - PORT=3000
      - MIGRATION_DATA_DIR=/app/migration_data
